# 快速開始指南 - 進階逐句分析

## 🎯 功能概述

進階逐句分析功能讓用戶在看完第二支廣告後，可以查看對話的逐句分析，包括每句話的背後含意、曖昧指數和評分理由。

---

## 🚀 如何測試

### 1. 啟動 App

```bash
cd /Users/kenhuang/Desktop/FlirtScan
flutter run
```

### 2. 測試流程

```
上傳對話截圖 
  ↓
看完第一支廣告
  ↓
查看初步分析結果
  ↓
點擊「進階逐句分析」按鈕
  ↓
看完第二支廣告
  ↓
查看逐句分析結果 ✨
  ↓
返回並再次點擊「進階逐句分析」
  ↓
直接跳轉（不需再看廣告）✨
```

---

## 📁 重要檔案

### 核心實作
- `lib/src/pages/result_page.dart` - 結果頁面（含廣告解鎖邏輯）
- `lib/src/pages/result_sentence_page.dart` - 逐句分析頁面
- `lib/src/core/providers/analysis_provider.dart` - 狀態管理
- `lib/src/core/models/analysis_result.dart` - 資料模型

### UI 元件
- `lib/src/widgets/cards/quote_analysis_card.dart` - 對話卡片
- `lib/src/widgets/cards/advanced_summary_card.dart` - 進階總結卡片

### 文件
- `進階逐句分析實作說明.md` - 完整實作說明
- `進階逐句分析測試指南.md` - 測試指南
- `進階逐句分析完成總結.md` - 完成總結

---

## 🔍 快速除錯

### 檢查廣告載入狀態

在 `result_page.dart` 的 `_handleAdvancedAnalysis` 方法中：

```dart
debugPrint('AdService.isAdLoaded: ${_adService.isAdLoaded}');
```

### 檢查解鎖狀態

在 `result_page.dart` 的 `_buildResultView` 方法中：

```dart
debugPrint('isAdvancedUnlocked: ${result.isAdvancedUnlocked}');
```

### 檢查逐句分析資料

在 `result_sentence_page.dart` 的 `build` 方法中：

```dart
debugPrint('sentences count: ${result.sentences.length}');
```

---

## ⚠️ 常見問題

### Q1: 點擊「進階逐句分析」後沒有反應

**可能原因**：
- 廣告未載入
- 網路連線問題

**解決方案**：
- 檢查 console 輸出
- 確認網路連線
- 等待廣告載入完成

### Q2: 逐句分析頁面顯示「沒有分析結果」

**可能原因**：
- `analysisProvider` 狀態為空
- 路由跳轉問題

**解決方案**：
- 檢查 `analysisProvider.result` 是否為 null
- 確認是從結果頁面跳轉過來的

### Q3: 廣告播放失敗

**可能原因**：
- 網路連線問題
- 廣告服務問題

**解決方案**：
- 檢查網路連線
- 確認使用測試廣告 ID
- 查看 console 錯誤訊息

---

## 📊 測試檢查清單

- [ ] 首次點擊「進階逐句分析」會播放廣告
- [ ] 廣告播放完成後跳轉到逐句分析頁面
- [ ] 逐句分析頁面正確顯示所有對話
- [ ] 對話卡片根據發話者顯示不同顏色
- [ ] 顯示背後含意、曖昧指數、評分理由
- [ ] 顯示進階總結卡片
- [ ] 再次進入結果頁面，點擊「進階逐句分析」直接跳轉

---

## 🎨 UI 預覽

### 結果頁面
- 曖昧指數卡片
- 雷達圖
- 總結
- **「進階逐句分析」按鈕** ← 新增

### 逐句分析頁面
- 頁面標題「逐句分析」
- 對話卡片列表
  - Partner（對方）：黃色背景，左對齊
  - Me（我）：藍色背景，右對齊
- 進階總結卡片（藍色邊框）
- 截圖按鈕

---

## 🔗 相關連結

- Figma 設計：https://www.figma.com/design/Z2YBZJO8AEbauRkU6YuwRQ/Flirt-Analysis?node-id=14-52
- 技術規格：`documents/tech spec.md`
- 產品計畫：`documents/product plan.md`

---

## 📞 需要幫助？

如果遇到問題，請：
1. 查看 console 輸出的 debug 訊息
2. 參考 `進階逐句分析測試指南.md`
3. 檢查相關文件

---

**最後更新**：2025-12-10  
**版本**：1.0.0






