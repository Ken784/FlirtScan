# 快速測試指南

## 🚀 如何測試廣告整合

### 前置準備

1. **確保已安裝依賴**
```bash
cd /Users/kenhuang/Desktop/FlirtScan
flutter pub get
```

2. **確認 iOS 模擬器或真機已連接**
```bash
flutter devices
```

### 測試步驟

#### 1. 啟動應用程式

```bash
flutter run
```

或在 iOS 模擬器上：
```bash
flutter run -d "iPhone 15 Pro"  # 替換為您的模擬器名稱
```

#### 2. 基本流程測試

**步驟 A：準備測試圖片**
- 在 iOS 模擬器中，拖曳一張圖片到模擬器中
- 或使用真機拍照/選擇相簿圖片

**步驟 B：開始分析**
1. 點擊「開始分析」或上傳按鈕
2. 選擇一張圖片
3. 點擊「開始分析」按鈕

**步驟 C：觀察行為**
- ✅ 應該立即跳轉到黑色背景的分析頁面
- ✅ 頂部應顯示「正在揣摩他/她的心思...」的掃描動畫
- ✅ 應該彈出全螢幕測試廣告

**步驟 D：看完廣告**
- 等待廣告播放（通常 5-30 秒）
- 點擊右上角的「X」關閉廣告（如果可以關閉）
- 或等待廣告自動結束

**步驟 E：查看結果**
- ✅ 廣告關閉後，等待分析完成
- ✅ 應自動跳轉到結果頁面
- ✅ 查看分析結果是否正常顯示

#### 3. 錯誤處理測試

**測試 1：廣告載入失敗**（較難模擬，需要關閉網路）
1. 關閉裝置網路連線
2. 重新啟動 App
3. 嘗試開始分析
4. ✅ 應顯示「廣告載入失敗，請稍後再試」錯誤對話框
5. ✅ 點擊「確定」後返回首頁

**測試 2：分析失敗**
1. 上傳一張非對話截圖的圖片（例如風景照）
2. 點擊「開始分析」
3. ✅ 應顯示錯誤對話框
4. ✅ 錯誤訊息應清楚說明問題
5. ✅ 點擊「確定」後返回首頁

### 測試廣告的特徵

Google 提供的測試廣告會有以下特徵：
- 廣告內容通常是 Google Ads 的宣傳內容
- 廣告左上角或底部會標示「Test Ad」或「廣告」字樣
- 點擊廣告不會產生真實的廣告費用
- 測試廣告可能會顯示不同類型的內容（影片、圖片等）

### 除錯技巧

#### 1. 查看 Console 日誌

在終端機中運行 App 時，注意以下日誌：

```
# 廣告載入成功
✓ 廣告已載入

# 分析開始
AnalysisService: 開始分析對話...

# 分析完成
AnalysisService: 分析完成
AnalysisService: 總分 X/10

# 廣告相關
用戶看完廣告
廣告被關閉
```

#### 2. 常見問題排查

**問題：廣告沒有顯示**
- 檢查網路連線
- 確認測試 ID 是否正確配置
- 查看 Console 是否有錯誤訊息
- 等待 5-10 秒讓廣告預載

**問題：看完廣告後沒有跳轉**
- 檢查 Console 日誌，確認分析是否完成
- 確認是否有錯誤訊息
- 重新啟動 App 測試

**問題：錯誤對話框沒有顯示**
- 確認本地化檔案已生成（運行 `flutter gen-l10n`）
- 檢查錯誤是否被正確拋出

### 效能測試

#### 測試項目

1. **廣告載入時間**
   - 從 App 啟動到廣告載入完成的時間
   - 目標：< 5 秒

2. **分析完成時間**
   - 從開始分析到收到結果的時間
   - 取決於網路速度和 Firebase Functions 回應時間

3. **記憶體使用**
   - 使用 Xcode Instruments 監控記憶體使用
   - 確認廣告關閉後記憶體正確釋放

### 模擬器 vs 真機

| 測試項目 | 模擬器 | 真機 |
|---------|--------|------|
| 廣告顯示 | ✅ 可以 | ✅ 可以 |
| 廣告點擊 | ⚠️ 有限制 | ✅ 完整 |
| 效能測試 | ⚠️ 不準確 | ✅ 準確 |
| 相機功能 | ❌ 不可用 | ✅ 可用 |

**建議**：使用真機進行完整測試，模擬器用於快速驗證流程。

### 測試檢查清單

複製以下清單進行測試：

```
基本功能
[ ] App 啟動正常
[ ] 可以選擇圖片
[ ] 點擊「開始分析」跳轉到分析頁面
[ ] 分析頁面顯示掃描動畫
[ ] 廣告正常顯示

廣告流程
[ ] 廣告可以正常播放
[ ] 廣告播放時間合理（5-30秒）
[ ] 可以關閉廣告（如果有關閉按鈕）
[ ] 廣告關閉後繼續分析流程

結果顯示
[ ] 分析結果正常顯示
[ ] 可以查看詳細分析
[ ] 可以返回首頁

錯誤處理
[ ] 無網路時顯示錯誤訊息
[ ] 無效圖片時顯示錯誤訊息
[ ] 錯誤對話框樣式正確
[ ] 點擊確定後正確返回

邊界情況
[ ] 快速點擊不會崩潰
[ ] 切換 App 後廣告狀態正確
[ ] 記憶體使用正常
```

### 測試報告範本

```markdown
## 測試報告

**測試日期**: YYYY-MM-DD
**測試裝置**: iPhone 15 Pro / 實體 iPhone
**iOS 版本**: 17.x
**App 版本**: 0.1.0

### 測試結果

#### 基本功能
- [ ] 通過
- 問題：___________

#### 廣告整合
- [ ] 通過
- 問題：___________

#### 錯誤處理
- [ ] 通過
- 問題：___________

### 發現的問題
1. ___________
2. ___________

### 建議改進
1. ___________
2. ___________
```

## 📱 iOS 特定測試

### App Tracking Transparency (ATT)

iOS 14.5+ 需要請求追蹤權限。目前測試廣告不需要，但正式版需要：

```dart
// 未來需要添加
import 'package:app_tracking_transparency/app_tracking_transparency.dart';

final status = await AppTrackingTransparency.requestTrackingAuthorization();
```

### 測試裝置設定

在 iOS 裝置上啟用測試模式：
1. 設定 → 隱私權 → 廣告
2. 開啟「限制廣告追蹤」（測試時可開可關）

## 🐛 問題回報

如果遇到問題，請記錄：
1. 詳細的重現步驟
2. Console 日誌
3. 截圖或錄影
4. 裝置和系統版本

---

**開始測試前**：確保已經運行 `flutter pub get` 並重新編譯 App。

**測試完成後**：填寫測試報告並記錄所有發現的問題。






